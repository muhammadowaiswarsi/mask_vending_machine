{"ast":null,"code":"import _toConsumableArray from\"/home/wasif/Documents/Office/mask_vending_machine/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _regeneratorRuntime from\"/home/wasif/Documents/Office/mask_vending_machine/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/wasif/Documents/Office/mask_vending_machine/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/home/wasif/Documents/Office/mask_vending_machine/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useEffect,useState}from\"react\";import\"./App.css\";import Amplify,{Auth,API,graphqlOperation}from\"aws-amplify\";import{AmplifyAuthenticator,AmplifySignIn,AmplifyForgotPassword,AmplifyConfirmSignIn,withAuthenticator}from\"@aws-amplify/ui-react\";import{AuthState}from\"@aws-amplify/ui-components\";import awsconfig from\"./aws-exports\";import Navbar from\"./components/Navbar/Index\";import MachinePage from\"./components/MachinePage/index.js\";import MoneyPage from\"./components/MoneyPage\";import{getMasqomatUser,getResellers,listOrders}from\"./graphql/queries\";import{createUser,UpdateOrders}from\"./graphql/mutation\";import{onUpdateProduct}from\"./graphql/subsciption\";import Form from\"./components/Form/form\";import Loader from\"react-spinners/ClipLoader\";import Axios from\"axios\";Amplify.configure(awsconfig);var AuthStateApp=function AuthStateApp(){var _user$attributes2;var _useState=useState(),_useState2=_slicedToArray(_useState,2),user=_useState2[0],setUser=_useState2[1];var _useState3=useState(\"machine\"),_useState4=_slicedToArray(_useState3,2),navselection=_useState4[0],setnavselection=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),data=_useState6[0],setData=_useState6[1];var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),vending=_useState8[0],setVending=_useState8[1];var _useState9=useState(false),_useState10=_slicedToArray(_useState9,2),ListOrder=_useState10[0],setListOrder=_useState10[1];var _useState11=useState(false),_useState12=_slicedToArray(_useState11,2),onlineList=_useState12[0],setOnlineList=_useState12[1];var _useState13=useState(false),_useState14=_slicedToArray(_useState13,2),offlineList=_useState14[0],setOfflineList=_useState14[1];var _useState15=useState(false),_useState16=_slicedToArray(_useState15,2),new1=_useState16[0],setnew=_useState16[1];var _useState17=useState(\"loading\"),_useState18=_slicedToArray(_useState17,2),verified=_useState18[0],setverified=_useState18[1];var _useState19=useState(false),_useState20=_slicedToArray(_useState19,2),loader=_useState20[0],setloader=_useState20[1];var selectNav=function selectNav(data){setnavselection(data);};var APICalling=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(masqomatEasyId,masqomatId){var _result$data,uniqClientId,result;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;uniqClientId=masqomatId;_context.next=4;return Axios({url:\"https://cors-anywhere.herokuapp.com/https://arcane-plains-65295.herokuapp.com/status\",method:\"POST\",data:{masqomatEasyId:masqomatEasyId,clientId:uniqClientId}});case 4:result=_context.sent;if(!((result===null||result===void 0?void 0:(_result$data=result.data)===null||_result$data===void 0?void 0:_result$data.toLowerCase())===\"online\")){_context.next=9;break;}return _context.abrupt(\"return\",true);case 9:return _context.abrupt(\"return\",false);case 10:_context.next=15;break;case 12:_context.prev=12;_context.t0=_context[\"catch\"](0);return _context.abrupt(\"return\",false);case 15:case\"end\":return _context.stop();}}},_callee,null,[[0,12]]);}));return function APICalling(_x,_x2){return _ref.apply(this,arguments);};}();// useEffect(() => {\n//   if (verified) APICalling();\n// }, [user, verified]);\nvar getData=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(id){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:setloader(true);API.graphql(graphqlOperation(getResellers,{id:id})).then(function(res){var _res$data,_res$data$listMasqoma,_res$data2,_res$data2$listMasqom;var temp=res===null||res===void 0?void 0:(_res$data=res.data)===null||_res$data===void 0?void 0:(_res$data$listMasqoma=_res$data.listMasqomats)===null||_res$data$listMasqoma===void 0?void 0:_res$data$listMasqoma.items;var _loop=function _loop(j){var _temp$j,_temp$j2;APICalling((_temp$j=temp[j])===null||_temp$j===void 0?void 0:_temp$j.easyId,(_temp$j2=temp[j])===null||_temp$j2===void 0?void 0:_temp$j2.id).then(function(res){console.log(res,\"status\");setData(function(prev){var tempData=prev?_toConsumableArray(prev):[];temp[j].online=res;if(res){var temp1=onlineList?_toConsumableArray(onlineList):[];temp1.push(temp);setOnlineList(temp1);}else{var temp2=offlineList?_toConsumableArray(offlineList):[];temp2.push(temp);setOfflineList(temp2);}tempData.push.apply(tempData,_toConsumableArray(temp));if(j===temp.length-1){setnew(Date.now());return tempData;}});});};for(var j=0;j<temp.length;j++){_loop(j);}if((res===null||res===void 0?void 0:(_res$data2=res.data)===null||_res$data2===void 0?void 0:(_res$data2$listMasqom=_res$data2.listMasqomats)===null||_res$data2$listMasqom===void 0?void 0:_res$data2$listMasqom.items.length)===0){setData([]);setloader(false);}}).catch(function(err){setloader(false);setData(false);});case 2:case\"end\":return _context2.stop();}}},_callee2);}));return function getData(_x3){return _ref2.apply(this,arguments);};}();useEffect(function(){if(data&&(data===null||data===void 0?void 0:data.length)>0){var tempdata=[];for(var i=0;i<(data===null||data===void 0?void 0:data.length);i++){for(var k=0;k<((_data$i=data[i])===null||_data$i===void 0?void 0:(_data$i$products=_data$i.products)===null||_data$i$products===void 0?void 0:_data$i$products.items.length);k++){var _data$i,_data$i$products,_data$i2,_data$i3,_data$i4,_data$i5,_data$i5$reseller,_data$i6,_data$i7,_data$i7$products,_data$i7$products$ite,_data$i8,_data$i8$products,_data$i8$products$ite,_data$i9,_data$i9$products,_data$i9$products$ite,_data$i10,_data$i10$products,_data$i10$products$it,_data$i11,_data$i11$products,_data$i11$products$it;tempdata.push({id:(_data$i2=data[i])===null||_data$i2===void 0?void 0:_data$i2.easyId,masqomatId:(_data$i3=data[i])===null||_data$i3===void 0?void 0:_data$i3.id,location:(_data$i4=data[i])===null||_data$i4===void 0?void 0:_data$i4.description,company:(_data$i5=data[i])===null||_data$i5===void 0?void 0:(_data$i5$reseller=_data$i5.reseller)===null||_data$i5$reseller===void 0?void 0:_data$i5$reseller.companyName,onlineStatus:((_data$i6=data[i])===null||_data$i6===void 0?void 0:_data$i6.online)?\"online\":\"offline\",availableMasks:\"\".concat((_data$i7=data[i])===null||_data$i7===void 0?void 0:(_data$i7$products=_data$i7.products)===null||_data$i7$products===void 0?void 0:(_data$i7$products$ite=_data$i7$products.items[k])===null||_data$i7$products$ite===void 0?void 0:_data$i7$products$ite.stock,\"/208\"),priceNetto:\"\".concat((_data$i8=data[i])===null||_data$i8===void 0?void 0:(_data$i8$products=_data$i8.products)===null||_data$i8$products===void 0?void 0:(_data$i8$products$ite=_data$i8$products.items[k])===null||_data$i8$products$ite===void 0?void 0:_data$i8$products$ite.priceNetto),profitShare:\"\".concat((_data$i9=data[i])===null||_data$i9===void 0?void 0:(_data$i9$products=_data$i9.products)===null||_data$i9$products===void 0?void 0:(_data$i9$products$ite=_data$i9$products.items[k])===null||_data$i9$products$ite===void 0?void 0:_data$i9$products$ite.profitShare),productId:\"\".concat((_data$i10=data[i])===null||_data$i10===void 0?void 0:(_data$i10$products=_data$i10.products)===null||_data$i10$products===void 0?void 0:(_data$i10$products$it=_data$i10$products.items[k])===null||_data$i10$products$it===void 0?void 0:_data$i10$products$it.id),name:\"\".concat((_data$i11=data[i])===null||_data$i11===void 0?void 0:(_data$i11$products=_data$i11.products)===null||_data$i11$products===void 0?void 0:(_data$i11$products$it=_data$i11$products.items[k])===null||_data$i11$products$it===void 0?void 0:_data$i11$products$it.name)});}}setloader(false);setVending(tempdata);}},[data,new1]);var getListOrder=function getListOrder(){API.graphql(graphqlOperation(listOrders)).then(function(res){setVending(function(prev){var temp=prev?_toConsumableArray(prev):[];var _loop2=function _loop2(i){var _res$data3,_res$data3$listOrders;temp[i].monthlySales=res===null||res===void 0?void 0:(_res$data3=res.data)===null||_res$data3===void 0?void 0:(_res$data3$listOrders=_res$data3.listOrders)===null||_res$data3$listOrders===void 0?void 0:_res$data3$listOrders.items.filter(function(item){var _temp$i,_item$masqomat;return((_temp$i=temp[i])===null||_temp$i===void 0?void 0:_temp$i.masqomatId)===(item===null||item===void 0?void 0:(_item$masqomat=item.masqomat)===null||_item$masqomat===void 0?void 0:_item$masqomat.id);}).length;};for(var i=0;i<(temp===null||temp===void 0?void 0:temp.length);i++){_loop2(i);}return temp;});});};useEffect(function(){getListOrder();},[new1]);useEffect(function(){Auth.currentAuthenticatedUser().then(function(res){setUser(res);}).catch(function(err){setUser(false);});},[AuthState]);var changeMoney=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(id,priceNetto,profitShare){return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return API.graphql(graphqlOperation(UpdateOrders,{input:{id:id,priceNetto:priceNetto,profitShare:profitShare}}));case 2:case\"end\":return _context3.stop();}}},_callee3);}));return function changeMoney(_x4,_x5,_x6){return _ref3.apply(this,arguments);};}();useEffect(function(){var onUpdate=API.graphql(graphqlOperation(onUpdateProduct)).subscribe({next:function next(createUserData){setVending(function(prevState){var temp=_toConsumableArray(prevState);for(var i=0;i<prevState.length;i++){var _temp$i2,_createUserData$value,_createUserData$value2,_createUserData$value3,_createUserData$value4;if(((_temp$i2=temp[i])===null||_temp$i2===void 0?void 0:_temp$i2.masqomatId)===(createUserData===null||createUserData===void 0?void 0:(_createUserData$value=createUserData.value)===null||_createUserData$value===void 0?void 0:(_createUserData$value2=_createUserData$value.data)===null||_createUserData$value2===void 0?void 0:(_createUserData$value3=_createUserData$value2.onUpdateProduct)===null||_createUserData$value3===void 0?void 0:(_createUserData$value4=_createUserData$value3.masqomat)===null||_createUserData$value4===void 0?void 0:_createUserData$value4.id)){var _createUserData$value5,_createUserData$value6,_createUserData$value7,_createUserData$value8,_createUserData$value9,_createUserData$value10;temp[i].priceNetto=createUserData===null||createUserData===void 0?void 0:(_createUserData$value5=createUserData.value)===null||_createUserData$value5===void 0?void 0:(_createUserData$value6=_createUserData$value5.data)===null||_createUserData$value6===void 0?void 0:(_createUserData$value7=_createUserData$value6.onUpdateProduct)===null||_createUserData$value7===void 0?void 0:_createUserData$value7.priceNetto;temp[i].profitShare=createUserData===null||createUserData===void 0?void 0:(_createUserData$value8=createUserData.value)===null||_createUserData$value8===void 0?void 0:(_createUserData$value9=_createUserData$value8.data)===null||_createUserData$value9===void 0?void 0:(_createUserData$value10=_createUserData$value9.onUpdateProduct)===null||_createUserData$value10===void 0?void 0:_createUserData$value10.profitShare;return temp;}}});}});},[]);var CreateUserMethod=function CreateUserMethod(input){setloader(true);API.graphql(graphqlOperation(createUser,{input:input})).then(function(res1){var _res1$data;setverified(res1===null||res1===void 0?void 0:(_res1$data=res1.data)===null||_res1$data===void 0?void 0:_res1$data.createMasqomatUser);setloader(false);}).catch(function(err1){setloader(false);});};useEffect(function(){if(user){var _user$attributes;setloader(true);API.graphql(graphqlOperation(getMasqomatUser,{id:user===null||user===void 0?void 0:(_user$attributes=user.attributes)===null||_user$attributes===void 0?void 0:_user$attributes.sub})).then(function(res1){var _res1$data2;setverified(res1===null||res1===void 0?void 0:(_res1$data2=res1.data)===null||_res1$data2===void 0?void 0:_res1$data2.getMasqomatUser);setloader(false);for(var i=0;i<(res1===null||res1===void 0?void 0:(_res1$data3=res1.data)===null||_res1$data3===void 0?void 0:(_res1$data3$getMasqom=_res1$data3.getMasqomatUser)===null||_res1$data3$getMasqom===void 0?void 0:(_res1$data3$getMasqom2=_res1$data3$getMasqom.masqomats)===null||_res1$data3$getMasqom2===void 0?void 0:_res1$data3$getMasqom2.length);i++){var _res1$data3,_res1$data3$getMasqom,_res1$data3$getMasqom2,_res1$data4,_res1$data4$getMasqom;getData(res1===null||res1===void 0?void 0:(_res1$data4=res1.data)===null||_res1$data4===void 0?void 0:(_res1$data4$getMasqom=_res1$data4.getMasqomatUser)===null||_res1$data4$getMasqom===void 0?void 0:_res1$data4$getMasqom.masqomats[i]);}}).catch(function(err1){setloader(false);});}},[user]);if(loader)return/*#__PURE__*/React.createElement(\"div\",{className:\"loader\"},/*#__PURE__*/React.createElement(Loader,null));if(user===null||user===void 0?void 0:(_user$attributes2=user.attributes)===null||_user$attributes2===void 0?void 0:_user$attributes2.sub){var _user$attributes3;if(verified!==\"loading\"&&verified)return/*#__PURE__*/React.createElement(\"div\",{className:\"App\"},/*#__PURE__*/React.createElement(\"div\",{className:\"container\"},/*#__PURE__*/React.createElement(Navbar,{selectNav:selectNav}),navselection===\"machine\"?/*#__PURE__*/React.createElement(MachinePage,{vending:vending,onlineList:onlineList,oflineList:offlineList,ListOrder:ListOrder}):/*#__PURE__*/React.createElement(MoneyPage,{changeMoney:changeMoney,data:vending})));else return/*#__PURE__*/React.createElement(Form,{CreateUser:CreateUserMethod,setverified:setverified,userId:user===null||user===void 0?void 0:(_user$attributes3=user.attributes)===null||_user$attributes3===void 0?void 0:_user$attributes3.sub,username:user===null||user===void 0?void 0:user.username});}else return/*#__PURE__*/React.createElement(\"div\",{className:\"authentication-page\"},/*#__PURE__*/React.createElement(AmplifyAuthenticator,null,/*#__PURE__*/React.createElement(AmplifySignIn,{slot:\"sign-in\",usernameAlias:\"email\",hideSignUp:true},/*#__PURE__*/React.createElement(\"div\",{slot:\"secondary-footer-content\"}))));};export default withAuthenticator(AuthStateApp);","map":{"version":3,"sources":["/home/wasif/Documents/Office/mask_vending_machine/src/App.js"],"names":["React","useEffect","useState","Amplify","Auth","API","graphqlOperation","AmplifyAuthenticator","AmplifySignIn","AmplifyForgotPassword","AmplifyConfirmSignIn","withAuthenticator","AuthState","awsconfig","Navbar","MachinePage","MoneyPage","getMasqomatUser","getResellers","listOrders","createUser","UpdateOrders","onUpdateProduct","Form","Loader","Axios","configure","AuthStateApp","user","setUser","navselection","setnavselection","data","setData","vending","setVending","ListOrder","setListOrder","onlineList","setOnlineList","offlineList","setOfflineList","new1","setnew","verified","setverified","loader","setloader","selectNav","APICalling","masqomatEasyId","masqomatId","uniqClientId","url","method","clientId","result","toLowerCase","getData","id","graphql","then","res","temp","listMasqomats","items","j","easyId","console","log","prev","tempData","online","temp1","push","temp2","length","Date","now","catch","err","tempdata","i","k","products","location","description","company","reseller","companyName","onlineStatus","availableMasks","stock","priceNetto","profitShare","productId","name","getListOrder","monthlySales","filter","item","masqomat","currentAuthenticatedUser","changeMoney","input","onUpdate","subscribe","next","createUserData","prevState","value","CreateUserMethod","res1","createMasqomatUser","err1","attributes","sub","masqomats","username"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from \"react\";\nimport \"./App.css\";\nimport Amplify, { Auth, API, graphqlOperation } from \"aws-amplify\";\nimport {\n  AmplifyAuthenticator,\n  AmplifySignIn,\n  AmplifyForgotPassword,\n  AmplifyConfirmSignIn,\n  withAuthenticator,\n} from \"@aws-amplify/ui-react\";\nimport { AuthState } from \"@aws-amplify/ui-components\";\nimport awsconfig from \"./aws-exports\";\nimport Navbar from \"./components/Navbar/Index\";\nimport MachinePage from \"./components/MachinePage/index.js\";\nimport MoneyPage from \"./components/MoneyPage\";\nimport { getMasqomatUser, getResellers, listOrders } from \"./graphql/queries\";\nimport { createUser, UpdateOrders } from \"./graphql/mutation\";\nimport { onUpdateProduct } from \"./graphql/subsciption\";\nimport Form from \"./components/Form/form\";\nimport Loader from \"react-spinners/ClipLoader\";\nimport Axios from \"axios\";\n\nAmplify.configure(awsconfig);\n\nconst AuthStateApp = () => {\n  const [user, setUser] = useState();\n  const [navselection, setnavselection] = useState(\"machine\");\n  const [data, setData] = useState(false);\n  const [vending, setVending] = useState(false);\n  const [ListOrder, setListOrder] = useState(false);\n  const [onlineList, setOnlineList] = useState(false);\n  const [offlineList, setOfflineList] = useState(false);\n  const [new1, setnew] = useState(false);\n  const [verified, setverified] = useState(\"loading\");\n  const [loader, setloader] = useState(false);\n\n  const selectNav = (data) => {\n    setnavselection(data);\n  };\n\n  const APICalling = async (masqomatEasyId, masqomatId) => {\n    try {\n      const uniqClientId = masqomatId;\n      const result = await Axios({\n        url: \"https://cors-anywhere.herokuapp.com/https://arcane-plains-65295.herokuapp.com/status\",\n        method: \"POST\",\n        data: {\n          masqomatEasyId: masqomatEasyId,\n          clientId: uniqClientId,\n        },\n      });\n      if (result?.data?.toLowerCase() === \"online\") {\n        return true;\n      } else {\n        //NOT ONLINE\n        return false;\n      }\n    } catch (err) {\n      return false;\n      //NOT ONLINE\n    }\n  };\n  // useEffect(() => {\n  //   if (verified) APICalling();\n  // }, [user, verified]);\n\n  const getData = async (id) => {\n    setloader(true);\n    API.graphql(graphqlOperation(getResellers, { id }))\n      .then((res) => {\n        let temp = res?.data?.listMasqomats?.items;\n        for (let j = 0; j < temp.length; j++) {\n          APICalling(temp[j]?.easyId, temp[j]?.id).then((res) => {\n            console.log(res, \"status\")\n            setData((prev) => {\n              let tempData = prev ? [...prev] : [];\n              temp[j].online = res;\n              if (res) {\n                let temp1 = onlineList ? [...onlineList] : [];\n                temp1.push(temp);\n                setOnlineList(temp1);\n              } else {\n                let temp2 = offlineList ? [...offlineList] : [];\n                temp2.push(temp);\n                setOfflineList(temp2);\n              }\n              tempData.push(...temp);\n              if (j === temp.length - 1) {\n                setnew(Date.now());\n                return tempData;\n              }\n            });\n          });\n        }\n        if (res?.data?.listMasqomats?.items.length === 0) {\n          setData([]);\n          setloader(false);\n        }\n      })\n      .catch((err) => {\n        setloader(false);\n        setData(false);\n      });\n  };\n\n  useEffect(() => {\n    if (data && data?.length > 0) {\n      const tempdata = [];\n      for (let i = 0; i < data?.length; i++) {\n        for (let k = 0; k < data[i]?.products?.items.length; k++) {\n          tempdata.push({\n            id: data[i]?.easyId,\n            masqomatId: data[i]?.id,\n            location: data[i]?.description,\n            company: data[i]?.reseller?.companyName,\n            onlineStatus: data[i]?.online ? \"online\" : \"offline\",\n            availableMasks: `${data[i]?.products?.items[k]?.stock}/208`,\n            priceNetto: `${data[i]?.products?.items[k]?.priceNetto}`,\n            profitShare: `${data[i]?.products?.items[k]?.profitShare}`,\n            productId: `${data[i]?.products?.items[k]?.id}`,\n            name: `${data[i]?.products?.items[k]?.name}`,\n          });\n        }\n      }\n      setloader(false);\n      setVending(tempdata);\n    }\n  }, [data, new1]);\n\n  const getListOrder = () => {\n    API.graphql(graphqlOperation(listOrders)).then((res) => {\n      setVending((prev) => {\n        let temp = prev ? [...prev] : [];\n        for (let i = 0; i < temp?.length; i++) {\n          temp[i].monthlySales = res?.data?.listOrders?.items.filter(\n            (item) => temp[i]?.masqomatId === item?.masqomat?.id\n          ).length;\n        }\n        return temp;\n      });\n    });\n  };\n\n  useEffect(() => {\n    getListOrder();\n  }, [new1]);\n\n  useEffect(() => {\n    Auth.currentAuthenticatedUser()\n      .then((res) => {\n        setUser(res);\n      })\n      .catch((err) => {\n        setUser(false);\n      });\n  }, [AuthState]);\n\n  const changeMoney = async (id, priceNetto, profitShare) => {\n    await API.graphql(\n      graphqlOperation(UpdateOrders, { input: { id, priceNetto, profitShare } })\n    );\n  };\n\n  useEffect(() => {\n    let onUpdate = API.graphql(graphqlOperation(onUpdateProduct)).subscribe({\n      next: (createUserData) => {\n        setVending((prevState) => {\n          let temp = [...prevState];\n          for (let i = 0; i < prevState.length; i++) {\n            if (\n              temp[i]?.masqomatId ===\n              createUserData?.value?.data?.onUpdateProduct?.masqomat?.id\n            ) {\n              temp[i].priceNetto =\n                createUserData?.value?.data?.onUpdateProduct?.priceNetto;\n              temp[i].profitShare =\n                createUserData?.value?.data?.onUpdateProduct?.profitShare;\n              return temp;\n            }\n          }\n        });\n      },\n    });\n  }, []);\n\n  const CreateUserMethod = (input) => {\n    setloader(true);\n    API.graphql(graphqlOperation(createUser, { input: input }))\n\n      .then((res1) => {\n        setverified(res1?.data?.createMasqomatUser);\n        setloader(false);\n      })\n      .catch((err1) => {\n        setloader(false);\n      });\n  };\n\n  useEffect(() => {\n    if (user) {\n      setloader(true);\n      API.graphql(\n        graphqlOperation(getMasqomatUser, { id: user?.attributes?.sub })\n      )\n        .then((res1) => {\n          setverified(res1?.data?.getMasqomatUser);\n          setloader(false);\n          for (\n            let i = 0;\n            i < res1?.data?.getMasqomatUser?.masqomats?.length;\n            i++\n          ) {\n            getData(res1?.data?.getMasqomatUser?.masqomats[i]);\n          }\n        })\n        .catch((err1) => {\n          setloader(false);\n        });\n    }\n  }, [user]);\n\n  if (loader)\n    return (\n      <div className=\"loader\">\n        <Loader />\n      </div>\n    );\n  if (user?.attributes?.sub) {\n    if (verified !== \"loading\" && verified)\n      return (\n        <div className=\"App\">\n          <div className=\"container\">\n            <Navbar selectNav={selectNav} />\n            {navselection === \"machine\" ? (\n              <MachinePage\n                vending={vending}\n                onlineList={onlineList}\n                oflineList={offlineList}\n                ListOrder={ListOrder}\n              />\n            ) : (\n              <MoneyPage changeMoney={changeMoney} data={vending} />\n            )}\n          </div>\n        </div>\n      );\n    else\n      return (\n        <Form\n          CreateUser={CreateUserMethod}\n          setverified={setverified}\n          userId={user?.attributes?.sub}\n          username={user?.username}\n        />\n      );\n  } else\n    return (\n      <div className=\"authentication-page\">\n        <AmplifyAuthenticator>\n          <AmplifySignIn slot=\"sign-in\" usernameAlias=\"email\" hideSignUp>\n            <div slot=\"secondary-footer-content\"></div>\n          </AmplifySignIn>\n        </AmplifyAuthenticator>\n      </div>\n    );\n};\n\nexport default withAuthenticator(AuthStateApp);\n"]},"metadata":{},"sourceType":"module"}